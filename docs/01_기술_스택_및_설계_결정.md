## 기술 스택 및 설계 결정

### Backend 기술 스택

| 기술 | 버전 | 선정 이유 |
|------|------|----------|
| **Ruby on Rails** | 8.0 | 빠른 개발, RESTful API 구축 용이 |
| **MySQL** | 8.0+ | 널리 사용되는 RDBMS, mysql2 어댑터로 Rails 기본 지원 |
| **JWT** | - | Stateless 인증, 마이크로서비스 확장 용이 |
| **Google Gemini API** | 2.5 Flash | 빠른 응답속도, 스트리밍 지원, 한국어 성능 우수 |
| **Minitest** | - | Rails 기본 테스트 프레임워크, 가볍고 빠름 |

### Frontend 기술 스택

| 기술 | 버전 | 선정 이유 |
|------|------|----------|
| **React** | 19 | 컴포넌트 기반, 생태계 풍부 |
| **TypeScript** | 4.9 | 필수 요구사항. 타입 안정성, 개발 생산성 향상 |
| **React Router** | 7.x | SPA 라우팅, 선언적 라우팅 |
| **Axios** | 1.x | HTTP 클라이언트, 인터셉터 지원 |
| **Web Speech API** | - | 브라우저 네이티브 STT/TTS, 별도 API 불필요 |
| **Server-Sent Events** | - | 단방향 스트리밍, WebSocket보다 간단 |
| **React Markdown** | - | AI 응답 마크다운 렌더링 |

### 주요 설계 결정 및 배경

#### 1. **아키텍처 설계**

**선택: RESTful API + SPA (Single Page Application)**

**이유:**
- Backend와 Frontend 완전 분리 → 독립적 배포 및 확장 가능
- API 재사용성: 향후 모바일 앱 개발 시 동일 API 사용 가능
- 팀 분업 용이: Backend/Frontend 개발자 독립적 작업

#### 2. **인증 방식**

**선택: JWT (JSON Web Token)**

**이유:**
- Stateless: 서버 확장 시 세션 공유 불필요
- 마이크로서비스 친화적: 여러 서비스에서 동일 토큰 검증 가능
- 모바일 앱 대응 용이

#### 3. **AI 모델 선택**

**선택: Google Gemini 2.5 Flash Lite**

**이유:**
- **빠른 응답속도**: Flash 모델로 실시간 대화 최적화
- **스트리밍 지원**: SSE로 점진적 응답 표시
- **한국어 성능**: GPT-4 대비 우수한 한국어 처리
- **비용 효율**: 무료 티어 제공, 초기 개발 비용 절감

#### 4. **음성 인식/합성**

**선택: Web Speech API**

**이유:**
- 브라우저 네이티브: 별도 서버 비용 없음
- 실시간 처리: 클라이언트에서 즉시 변환
- 간단한 구현: 복잡한 백엔드 처리 불필요

**한계 및 대응:**
- Chrome/Edge 브라우저에서 가장 정확하게 작동합니다
- 다른 브라우저의 경우 지원 레벨이 다를 수 있습니다

#### 5. **스트리밍 응답 (응답 지연 최소화)** 

**선택: Server-Sent Events (SSE)**

**이유:**
- 단방향 통신으로 충분: 서버 → 클라이언트만 필요
- WebSocket 대비 간단: 연결 관리 용이
- HTTP/2 호환: 기존 인프라 활용
- **응답 속도**: 첫 단어까지 **0.1-0.3초** (일반 응답 대비 80% 개선)

**응답 지연 최소화 전략:**

1. **SSE 스트리밍**: 청크 단위 실시간 표시
2. **API 파라미터 최적화**: 
   - `temperature: 0.5` (더 결정적, 빠른 생성)
   - `maxOutputTokens: 500` (간결한 답변)
3. **프롬프트 엔지니어링**: "2-4문장" 제한, 핵심부터 답변
4. **타이핑 인디케이터**: AI 응답 대기 중 UX 개선
5. **낙관적 UI 업데이트**: 사용자 메시지 즉시 표시

**성능 비교:**
```
일반 응답: 3-5초 대기 후 전체 표시
스트리밍: 0.2초 후 첫 단어, 점진적 표시 (체감 80% 빠름)
```

#### 6. **데이터베이스 설계**

**멤버십 시스템:**
```
User ─────< Membership
  └─ chat_coupons (integer)
  
Membership
  └─ features (string, 쉼표 구분)
```

#### 7. **에러 처리**

**전략:**
- 모든 API에 표준 에러 포맷 적용
- 사용자 친화적 한국어 메시지
- 로그 레벨 분리 (INFO, ERROR)

```ruby
# 표준 에러 응답
{
  "error": "사용자 친화적 메시지",
  "details": "개발자용 상세 정보" (optional)
}
```

#### 8. **테스트 전략**

**Backend: Minitest**
- 모델 테스트: 비즈니스 로직 검증
- 컨트롤러 테스트: API 엔드포인트 검증
- 통합 테스트: 전체 플로우 검증

**Frontend: Jest + React Testing Library**
- 컴포넌트 단위 테스트
- 사용자 인터랙션 테스트

#### 9. **확장 가능한 구조**

**확장 포인트:**
1. 새 멤버십 추가: DB 레코드만 추가
2. 새 기능 추가: features 문자열에 추가
3. 새 AI 모델: GeminiClient 인터페이스 유지하며 교체
4. 새 결제 수단: PaymentsController에 전략 패턴 적용
